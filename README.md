## เรียนรู้การออกแบบ micro service ด้วย Hexagonal Architecture

<br />

### **Repository (domain model)** <br />
```
เป็นส่วนที่ใช้ติดต่อกับฐานข้อมูล เช่น RDBMS, NoSQL, In memory database เป็นต้น
```

### **Service** <br />
```
เป็นส่วนของ Business Logic กำหนดว่ามี Service อะไรให้บริการบ้าง
ควร Response อะไรบ้าง หรือควรบอก error อย่างไรให้ user รู้
เป็นมุมมองของคนทำ Business Analysts หรือ SA
```

### **Handler** <br />
```
เป็นส่วนของการจัดการ Operation ต่าง ๆ ตามที่ Request เข้ามา
แล้ว Response กลับไป
```

<br />

### **Why Hexagonal Architecture?**
- สามารถแบ่งงานกับคนในทีมได้ง่ายขึ้น
- สามารถโฟกัสงานของตัวเองได้ดีขึ้น เช่น <br />
  คนทำ BL สามารถทำงานได้โดยไม่ต้องกังวลเกี่ยวกับ database มากจนเกินไป, <br />
  คนทำด้านติดต่อกับ database แค่ทำงานของตัวเองแล้วส่งต่อให้ BL
- สามารถแก้ไข/ต่อเติมได้ง่าย ไม่ต้องไล่แก้โค้ดเยอะ ด้วยการเขียนแบบ Port and Adapter <br />
  Port คือ ส่วนที่กำหนดว่ามีฟังก์ชันการใช้งานอะไรบ้าง มีข้อมูลอะไรบ้าง
  Adapter คือ ส่วนของการทำงานของฟังก์ชันนั้น ๆ <br />
  ยกตัวอย่าง port, adapter เช่น Computer มี Port USB type A สามารถเสียบ mouse หรือ keyboard เพื่อใช้งานได้ <br />
  ซึ่ง mouse หรือ keyboard ก็คือ Adapter เราสามารถเพิ่ม/เปลี่ยน Adapter ได้เรื่อย ๆ หากสามารถใช้งานกับ Port ได้

<br />

### **ตัวอย่างเปรียบเทียบการเขียนแบบ port and adapter กับ เขียนแบบทั่วไป**
- models เป็นการเขียนแบบ Port and Adapter ไฟล์ user.go เป็น Port กำหนดว่าใน Entity นั้นมีข้อมูลอะไรบ้าง และมีฟังก์ชันอะไรบ้างที่ใช้งาน Entity นั้น <br />
  ไฟล์ user_db.go เป็น Adapter กำหนดการทำงานของแต่ละฟัฅก์ชัน
- การเรียกใช้งาน models ในไฟล์ main.go เพียงแค่ทำการเชื่อมต่อฐานข้อมูล MySQL และส่ง parameter ไปยัง models ที่เรียกใช้งาน หมายความว่า models นี้ใช้ฐานข้อมูล MySQL <br />
  เราสามารถเปลี่ยนเป็น Postgres ได้**เพียงแค่ส่ง parameter** ไปเท่านั้น แต่อาจจำเป็นต้องเปลี่ยนคำสั่ง Query บ้างเล็กน้อยเนื่องจากฐานข้อมูลแต่ละตัวใช้คำสั่งต่างกัน
- caching ไม่ได้เขียนแบบ Port and Adapter นั่นทำให้ทุกที่ที่เรียกใช้งาน Redis จำเป็นต้องเชื่อมต่อใหม่แทบทุกครั้ง เช่น ไฟล์ controllers/apikey.go หรือใน check_cache.go <br />
  ทำให้การแก้ไขเพิ่มเติมทำได้ยาก เพราะต้องแก้โค้ดทุกที่ที่เรียกใช้ หากโปรเจคมีขนาดใหญ่ มีหลายไฟล์ มีเป็นพันบรรทัดก็ต้องหาและแก้ไปเรื่อย ๆ ซึ่งอาจเกิดข้อผิดพลาดและใช้เวลานาน หรืออาจถึงขั้นรื้อเขียนใหม่

<br />

### ปล.
- ผู้เขียนเพิ่งเริ่มต้นศึกษาได้ไม่นาน และเขียนตามการลองผิดลองถูก ตามความเข้าใจของผู้เขียนเอง หากมีส่วนใดผิดก็ขออภัยมา ณ ที่นี้ และขอบคุณทุกคำแนะนำ ผู้เขียนพร้อมน้อมรับเพื่อเป็นความรู้แก่ตัวผู้เขียนเอง และเพื่อแบ่งปันความรู้นี้แก่ผู้อื่นต่อไป
